PRAGMA foreign_keys = OFF;

CREATE TABLE catalog_items_new (
  id TEXT PRIMARY KEY,
  type TEXT NOT NULL CHECK (type IN ('product', 'inspiration')),
  name TEXT NOT NULL,
  slug TEXT NOT NULL UNIQUE,
  description TEXT,
  short_desc TEXT,
  long_desc TEXT,
  hero_image TEXT,
  collection TEXT,
  categories TEXT,
  gender TEXT,
  styles TEXT,
  motifs TEXT,
  metals TEXT,
  metal_options TEXT,
  stone_types TEXT,
  stone_type_options TEXT,
  stone_weight TEXT,
  stone_weight_range TEXT,
  metal_weight TEXT,
  metal_weight_range TEXT,
  palette TEXT,
  takeaways TEXT,
  translation_notes TEXT,
  design_code TEXT,
  cut TEXT,
  cut_range TEXT,
  clarity TEXT,
  clarity_range TEXT,
  color TEXT,
  color_range TEXT,
  carat TEXT,
  is_active INTEGER NOT NULL DEFAULT 1,
  is_featured INTEGER NOT NULL DEFAULT 0,
  tags TEXT,
  created_at TEXT NOT NULL DEFAULT (datetime('now')),
  updated_at TEXT NOT NULL DEFAULT (datetime('now')),
  updated_by TEXT
);

INSERT INTO catalog_items_new (
  id,
  type,
  name,
  slug,
  description,
  short_desc,
  long_desc,
  hero_image,
  collection,
  categories,
  gender,
  styles,
  motifs,
  metals,
  metal_options,
  stone_types,
  stone_type_options,
  stone_weight,
  stone_weight_range,
  metal_weight,
  metal_weight_range,
  palette,
  takeaways,
  translation_notes,
  design_code,
  cut,
  cut_range,
  clarity,
  clarity_range,
  color,
  color_range,
  carat,
  is_active,
  is_featured,
  tags,
  created_at,
  updated_at,
  updated_by
)
SELECT
  id,
  type,
  name,
  slug,
  description,
  short_desc,
  long_desc,
  hero_image,
  collection,
  categories,
  gender,
  styles,
  motifs,
  metals,
  metal_options,
  stone_types,
  stone_type_options,
  stone_weight,
  stone_weight_range,
  metal_weight,
  metal_weight_range,
  palette,
  takeaways,
  translation_notes,
  design_code,
  cut,
  cut_range,
  clarity,
  clarity_range,
  color,
  color_range,
  carat,
  is_active,
  is_featured,
  tags,
  created_at,
  updated_at,
  updated_by
FROM catalog_items;

DROP TABLE catalog_items;
ALTER TABLE catalog_items_new RENAME TO catalog_items;

CREATE INDEX IF NOT EXISTS idx_catalog_items_type_active
  ON catalog_items (type, is_active, is_featured);

PRAGMA foreign_keys = ON;
