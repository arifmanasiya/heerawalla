---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { loadSiteConfig, getConfigValue } from '../lib/config';

const config = await loadSiteConfig();
const ordersEmail = getConfigValue(config, 'orders_email', 'atelier@heerawalla.com');
---

<BaseLayout
  title="Secure Checkout | Heerawalla"
  description="Secure checkout placeholder for Heerawalla order confirmations."
>
  <Header />

  <main class="container py-12 space-y-10">
    <section class="grid gap-10 lg:grid-cols-[1.1fr_0.9fr] items-start">
      <div class="space-y-4">
        <p class="text-xs uppercase tracking-[0.3em] text-slate-500">Secure checkout</p>
        <h1 class="font-display text-4xl sm:text-5xl tracking-tight text-ink">Payment handoff</h1>
        <p class="text-sm text-slate-600 max-w-xl">
          This is a placeholder for the secure checkout handoff. Once your payment gateway is connected,
          this page will redirect to the live checkout experience.
        </p>

        <div class="border border-slate-200 bg-white p-6 space-y-4">
          <div class="text-xs uppercase tracking-[0.2em] text-slate-500">Order</div>
          <p class="text-sm text-ink" data-pay-request>Request ID: --</p>
          <p class="text-xs text-slate-500" data-pay-token>Token: --</p>
        </div>
      </div>

      <aside class="space-y-4">
        <div class="card border border-slate-200 p-6 space-y-3">
          <div class="text-xs uppercase tracking-[0.3em] text-slate-500">Next steps</div>
          <p class="text-sm text-slate-600">
            Connect Stripe/PayPal/Google Pay in your order confirmation backend, then update the payment
            URL template so customers are redirected immediately.
          </p>
        </div>
        <div class="border border-slate-200 bg-white p-5 text-sm text-slate-600 space-y-2">
          <p class="text-xs uppercase tracking-[0.2em] text-slate-500">Need assistance?</p>
          <p>
            Reach our concierge at
            <a class="underline text-ink" href={`mailto:${ordersEmail}`}>{ordersEmail}</a>.
          </p>
        </div>
      </aside>
    </section>
  </main>

  <Footer />
</BaseLayout>

<script is:inline>
  (() => {
    const params = new URLSearchParams(window.location.search);
    const requestId = params.get('requestId') || params.get('request_id') || params.get('id') || '--';
    const token = params.get('token') || params.get('t') || '--';
    const requestEl = document.querySelector('[data-pay-request]');
    const tokenEl = document.querySelector('[data-pay-token]');
    if (requestEl) requestEl.textContent = `Request ID: ${requestId}`;
    if (tokenEl) tokenEl.textContent = `Token: ${token}`;
  })();
</script>
